---
title: Facebooks prophet
author: Claus Gaarde Pedersen
date: '2017-07-23'
slug: facebooks-prophet
categories: []
summary: Using dygraph and Facebooks prophet function to show development in Odenses real estate prices
tags:
  - R
  - Timeseries
header:
  image: "headers/faceprophet.PNG"
---

<script src="/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="/rmarkdown-libs/jquery/jquery.min.js"></script>
<link href="/rmarkdown-libs/dygraphs/dygraph.css" rel="stylesheet" />
<script src="/rmarkdown-libs/dygraphs/dygraph-combined.js"></script>
<script src="/rmarkdown-libs/moment/moment.js"></script>
<script src="/rmarkdown-libs/moment-timezone/moment-timezone-with-data.js"></script>
<script src="/rmarkdown-libs/moment-fquarter/moment-fquarter.min.js"></script>
<script src="/rmarkdown-libs/dygraphs-binding/dygraphs.js"></script>

<div id="prophesying-odenses-real-estate-prices" class="section level2">
<h2>Prophesying Odenses real estate prices</h2>
<p>The purpose of this small study is try <a href="https://facebookincubator.github.io/prophet/">Facebooks Prophet</a>, which can be used for forecasting timeseries. This spring they have open sourced it, so others can have a go at it. I also want to showoff <a href="https://rstudio.github.io/dygraphs/">dygraphs</a>, which is a javascript library for visualizing timeseries - interactively of course.<br />
The data used will be real estate prices from the most important city in Denmark - Odense (the city where i live). The real estate prices comes from <a href="http://finansdanmark.dk/rkr/">Finans Danmark</a> an association of danish banks and mortgage companies. The prices are only quarterly, so they are not the most obvious to see seasonal trends in the data, it would have been nicer with more time periods but there is not enough sales for that.</p>
<p>Setup including all the packages used.</p>
<pre class="r"><code>knitr::opts_chunk$set(echo=TRUE, fig.width=8)
library(dplyr)
library(readr)
library(tidyr)
library(lubridate)
library(purrr)
library(ggplot2)
library(stringi)
library(xts)
library(imputeTS)
library(prophet)
library(RColorBrewer)
library(dygraphs)

# reading csv from http://rkr.statistikbank.dk/201 tabel bm011
bm011 &lt;- read_csv2(&quot;faceprophet/dst_bm011_2017_07_23.csv&quot;, skip=3, col_names=FALSE,
                   locale=locale(encoding=&quot;latin1&quot;))</code></pre>
<p>Kneading the data, to be easier to work with.</p>
<pre class="r"><code># csv is reading format with alot of text. that has to be cleaned
bm011 &lt;- bm011[-c(2:3),-c(1:2)]
colnames(bm011) &lt;- bm011[1,]
colnames(bm011)[1] &lt;- &quot;postnr&quot;
bm011 &lt;- bm011[-1,]
dst_na &lt;- bm011==&quot;..&quot;
bm011[dst_na] &lt;- NA
bm011[,-1] &lt;- map_df(bm011[,-1], as.integer)

# format postnr
bm011$postnr &lt;- stri_extract_last(bm011$postnr, regex=&quot;\\w+&quot;)

# knead the data to the right shape
gbm011 &lt;- gather(bm011, yearm, price, -postnr)
gbm011$date &lt;- yq(gbm011$yearm) + months(3)
gbm011$yearm &lt;- NULL
gbm011 &lt;- spread(gbm011, postnr, price)
# data is getting ready to be converted to timeseries
head(gbm011)</code></pre>
<pre><code>## # A tibble: 6 × 10
##         date     C     M     N    NV    NØ     S    SV    SØ     V
##       &lt;date&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
## 1 1992-04-01  4010  4459  4444  4376  4417  4306  4293  4776  4638
## 2 1992-07-01  4001  4466  4432  4530  4428  4976  4531  4541  4674
## 3 1992-10-01  3951  4452  4554  4929  4509  4664  4523  3999  3907
## 4 1993-01-01  3884  4518  4470  4471  3718  4616  4492  4785  3790
## 5 1993-04-01  3878  4151  4396  4418  4175  4596  4363  3995  4068
## 6 1993-07-01  3872  4538  4352  4680  4727  4393  4343  4186  4331</code></pre>
<p>Nice structure to convert to timeseris. But before that the missing values will be imputed. The impute method will be by moving average, which are fitting for a timeseries.</p>
<pre class="r"><code># wrap around imputTS::na.ma
impute_ma &lt;- function(df, ix, k=2, weighting=&quot;simple&quot;){
    df_imputed &lt;- sapply(ix, function(x) na.ma(df[[x]], k=k, weighting=weighting)) %&gt;%
        round() %&gt;% as.integer()
    df_retur &lt;- df
    df_retur[ix] &lt;- df_imputed
    colnames(df_retur) &lt;- colnames(df)
    df_retur
}
# impute missing values with moving average
gbm011 &lt;- impute_ma(gbm011, c(2:ncol(gbm011)))

# make timeseries object
bm_xts &lt;- xts(gbm011, order.by=gbm011$date)</code></pre>
<p>Timeseries constructed, now it can just be thrown at dygraph for visualization.</p>
<pre class="r"><code># plot prices
dyg &lt;- dygraph(bm_xts, main=&quot;Odense m2 prices for each postal area&quot;) %&gt;%
    dyHighlight(highlightSeriesOpts = list(strokeWidth = 3)) %&gt;% 
    dyLegend(width=720) %&gt;% 
    dyOptions(colors = brewer.pal(9, &quot;Set1&quot;), drawGrid=FALSE)
    # %&gt;% dyRangeSelector(fillColor=&quot;&quot;, strokeColor=&quot;&quot;)
dyg</code></pre>
<div id="htmlwidget-ecf2fa0eeb1f3592560a" style="width:768px;height:480px;" class="dygraphs html-widget"></div>
<script type="application/json" data-for="htmlwidget-ecf2fa0eeb1f3592560a">{"x":{"attrs":{"title":"Odense m2 prices for each postal area","labels":["quarter","date","C","M","N","NV","NØ","S","SV","SØ","V"],"retainDateWindow":false,"axes":{"x":{"pixelsPerLabel":60,"drawAxis":true},"y":{"drawAxis":true}},"highlightCircleSize":3,"highlightSeriesBackgroundAlpha":0.5,"highlightSeriesOpts":{"strokeWidth":3},"legend":"auto","labelsDivWidth":720,"labelsShowZeroValues":true,"labelsSeparateLines":false,"hideOverlayOnMouseOut":true,"stackedGraph":false,"fillGraph":false,"fillAlpha":0.15,"stepPlot":false,"drawPoints":false,"pointSize":1,"drawGapEdgePoints":false,"connectSeparatedPoints":false,"strokeWidth":1,"strokeBorderColor":"white","colors":["#E41A1C","#377EB8","#4DAF4A","#984EA3","#FF7F00","#FFFF33","#A65628","#F781BF","#999999"],"colorValue":0.5,"colorSaturation":1,"includeZero":false,"drawAxesAtZero":false,"logscale":false,"axisTickSize":3,"axisLineColor":"black","axisLineWidth":0.3,"axisLabelColor":"black","axisLabelFontSize":14,"axisLabelWidth":60,"drawGrid":false,"gridLineWidth":0.3,"rightGap":5,"digitsAfterDecimal":2,"labelsKMB":false,"labelsKMG2":false,"labelsUTC":false,"maxNumberWidth":6,"animatedZooms":false,"mobileDisableYTouch":true},"scale":"quarterly","annotations":[],"shadings":[],"events":[],"format":"date","data":[["1992-04-01T00:00:00.000Z","1992-07-01T00:00:00.000Z","1992-10-01T00:00:00.000Z","1993-01-01T00:00:00.000Z","1993-04-01T00:00:00.000Z","1993-07-01T00:00:00.000Z","1993-10-01T00:00:00.000Z","1994-01-01T00:00:00.000Z","1994-04-01T00:00:00.000Z","1994-07-01T00:00:00.000Z","1994-10-01T00:00:00.000Z","1995-01-01T00:00:00.000Z","1995-04-01T00:00:00.000Z","1995-07-01T00:00:00.000Z","1995-10-01T00:00:00.000Z","1996-01-01T00:00:00.000Z","1996-04-01T00:00:00.000Z","1996-07-01T00:00:00.000Z","1996-10-01T00:00:00.000Z","1997-01-01T00:00:00.000Z","1997-04-01T00:00:00.000Z","1997-07-01T00:00:00.000Z","1997-10-01T00:00:00.000Z","1998-01-01T00:00:00.000Z","1998-04-01T00:00:00.000Z","1998-07-01T00:00:00.000Z","1998-10-01T00:00:00.000Z","1999-01-01T00:00:00.000Z","1999-04-01T00:00:00.000Z","1999-07-01T00:00:00.000Z","1999-10-01T00:00:00.000Z","2000-01-01T00:00:00.000Z","2000-04-01T00:00:00.000Z","2000-07-01T00:00:00.000Z","2000-10-01T00:00:00.000Z","2001-01-01T00:00:00.000Z","2001-04-01T00:00:00.000Z","2001-07-01T00:00:00.000Z","2001-10-01T00:00:00.000Z","2002-01-01T00:00:00.000Z","2002-04-01T00:00:00.000Z","2002-07-01T00:00:00.000Z","2002-10-01T00:00:00.000Z","2003-01-01T00:00:00.000Z","2003-04-01T00:00:00.000Z","2003-07-01T00:00:00.000Z","2003-10-01T00:00:00.000Z","2004-01-01T00:00:00.000Z","2004-04-01T00:00:00.000Z","2004-07-01T00:00:00.000Z","2004-10-01T00:00:00.000Z","2005-01-01T00:00:00.000Z","2005-04-01T00:00:00.000Z","2005-07-01T00:00:00.000Z","2005-10-01T00:00:00.000Z","2006-01-01T00:00:00.000Z","2006-04-01T00:00:00.000Z","2006-07-01T00:00:00.000Z","2006-10-01T00:00:00.000Z","2007-01-01T00:00:00.000Z","2007-04-01T00:00:00.000Z","2007-07-01T00:00:00.000Z","2007-10-01T00:00:00.000Z","2008-01-01T00:00:00.000Z","2008-04-01T00:00:00.000Z","2008-07-01T00:00:00.000Z","2008-10-01T00:00:00.000Z","2009-01-01T00:00:00.000Z","2009-04-01T00:00:00.000Z","2009-07-01T00:00:00.000Z","2009-10-01T00:00:00.000Z","2010-01-01T00:00:00.000Z","2010-04-01T00:00:00.000Z","2010-07-01T00:00:00.000Z","2010-10-01T00:00:00.000Z","2011-01-01T00:00:00.000Z","2011-04-01T00:00:00.000Z","2011-07-01T00:00:00.000Z","2011-10-01T00:00:00.000Z","2012-01-01T00:00:00.000Z","2012-04-01T00:00:00.000Z","2012-07-01T00:00:00.000Z","2012-10-01T00:00:00.000Z","2013-01-01T00:00:00.000Z","2013-04-01T00:00:00.000Z","2013-07-01T00:00:00.000Z","2013-10-01T00:00:00.000Z","2014-01-01T00:00:00.000Z","2014-04-01T00:00:00.000Z","2014-07-01T00:00:00.000Z","2014-10-01T00:00:00.000Z","2015-01-01T00:00:00.000Z","2015-04-01T00:00:00.000Z","2015-07-01T00:00:00.000Z","2015-10-01T00:00:00.000Z","2016-01-01T00:00:00.000Z","2016-04-01T00:00:00.000Z","2016-07-01T00:00:00.000Z","2016-10-01T00:00:00.000Z","2017-01-01T00:00:00.000Z","2017-04-01T00:00:00.000Z"],["1992-04-01","1992-07-01","1992-10-01","1993-01-01","1993-04-01","1993-07-01","1993-10-01","1994-01-01","1994-04-01","1994-07-01","1994-10-01","1995-01-01","1995-04-01","1995-07-01","1995-10-01","1996-01-01","1996-04-01","1996-07-01","1996-10-01","1997-01-01","1997-04-01","1997-07-01","1997-10-01","1998-01-01","1998-04-01","1998-07-01","1998-10-01","1999-01-01","1999-04-01","1999-07-01","1999-10-01","2000-01-01","2000-04-01","2000-07-01","2000-10-01","2001-01-01","2001-04-01","2001-07-01","2001-10-01","2002-01-01","2002-04-01","2002-07-01","2002-10-01","2003-01-01","2003-04-01","2003-07-01","2003-10-01","2004-01-01","2004-04-01","2004-07-01","2004-10-01","2005-01-01","2005-04-01","2005-07-01","2005-10-01","2006-01-01","2006-04-01","2006-07-01","2006-10-01","2007-01-01","2007-04-01","2007-07-01","2007-10-01","2008-01-01","2008-04-01","2008-07-01","2008-10-01","2009-01-01","2009-04-01","2009-07-01","2009-10-01","2010-01-01","2010-04-01","2010-07-01","2010-10-01","2011-01-01","2011-04-01","2011-07-01","2011-10-01","2012-01-01","2012-04-01","2012-07-01","2012-10-01","2013-01-01","2013-04-01","2013-07-01","2013-10-01","2014-01-01","2014-04-01","2014-07-01","2014-10-01","2015-01-01","2015-04-01","2015-07-01","2015-10-01","2016-01-01","2016-04-01","2016-07-01","2016-10-01","2017-01-01","2017-04-01"],[" 4010"," 4001"," 3951"," 3884"," 3878"," 3872"," 4055"," 3970"," 4335"," 4595"," 4156"," 4291"," 4548"," 4725"," 4628"," 4917"," 4607"," 5246"," 5424"," 5445"," 5918"," 5956"," 6082"," 5619"," 6526"," 6697"," 7039"," 6909"," 6926"," 6954"," 7480"," 6659"," 6815"," 7013"," 6867"," 7142"," 7213"," 7353"," 7628"," 7516"," 7446"," 7932"," 7645"," 7622"," 7605"," 7348"," 8303"," 8734"," 8194"," 9886"," 9689"," 9763","10179","10713","11891","14054","13969","14211","14005","15304","14827","15503","15883","16027","15444","16445","16412","14226","14563","14505","14101","13325","15631","15552","14131","14356","14308","13946","14578","13764","12171","14471","14072","15301","13878","13401","14833","14485","14456","15405","14647","16460","15562","15977","16564","15062","17326","14775","15824","17272","16844"],[" 4459"," 4466"," 4452"," 4518"," 4151"," 4538"," 4759"," 4393"," 5006"," 5022"," 5306"," 5082"," 5482"," 5357"," 5811"," 5624"," 5429"," 6194"," 5995"," 6261"," 6664"," 7346"," 6842"," 7810"," 6875"," 8455"," 7779"," 7898"," 7885"," 8284"," 7858"," 9183"," 8161"," 8499"," 8127"," 8396"," 8681"," 8593"," 8768"," 8772"," 8228"," 8889"," 9147"," 9418"," 8661"," 8980"," 9197"," 9652","10281","10206"," 9840","10362","12193","12334","14046","14817","16226","15962","18492","18209","18324","17429","15168","20233","15590","17461","18274","17437","14146","15838","17101","15378","14296","15728","16499","16173","14935","15373","14381","14231","14751","15287","16815","15380","14631","16793","16181","16101","15922","16748","15976","15384","15779","17662","17476","17469","17417","18662","18158","17878","18905"],[" 4444"," 4432"," 4554"," 4470"," 4396"," 4352"," 4905"," 4624"," 5242"," 5179"," 4913"," 5086"," 5355"," 5193"," 5766"," 5387"," 5833"," 5998"," 6242"," 6150"," 6670"," 6714"," 6176"," 6699"," 7145"," 7061"," 7177"," 7590"," 7113"," 7357"," 7322"," 7391"," 7077"," 7218"," 7848"," 7457"," 7311"," 7466"," 7564"," 7003"," 7835"," 7816"," 7762"," 7638"," 7988"," 7396"," 7477"," 7476"," 7849"," 8496"," 8025"," 8112"," 8836"," 9412","10183","10617","11236","11682","12117","13064","13409","13637","13316","12366","13856","14423","12894","12969","13335","12348","11757","12429","12276","12364","11093","11800","11758","11982","11747","10174","10744","11064","11994","10727","10992","10928","10918","11220","11113","10946","12197","11783","11827","12431","12252","12695","12379","12610","12194","11210","12925"],[" 4376"," 4530"," 4929"," 4471"," 4418"," 4680"," 4851"," 4460"," 4617"," 4811"," 5010"," 5048"," 5333"," 5512"," 5311"," 5382"," 5498"," 5705"," 6033"," 6182"," 6449"," 6638"," 6930"," 6436"," 6887"," 7166"," 7643"," 7649"," 7679"," 7279"," 7545"," 7764"," 7127"," 7534"," 7613"," 7628"," 8500"," 8041"," 7688"," 7550"," 7893"," 7756"," 7313"," 7504"," 7475"," 8049"," 7729"," 7506"," 8183"," 8335"," 8516"," 8318"," 9305"," 9960","10562","11439","11954","12856","12594","13046","13719","14401","13918","13374","13612","13982","14339","13501","11459","12000","12598","12398","13026","12310","12677","12934","12807","11775","11314","10876","11239","11673","11291","11700","10703","11224","11558","11290","10752","11701","11713","11421","12173","12474","12476","12096","12654","12767","13559","13329","11120"],[" 4417"," 4428"," 4509"," 3718"," 4175"," 4727"," 4402"," 4530"," 5399"," 4812"," 4823"," 4796"," 4977"," 4825"," 5695"," 5427"," 5668"," 5452"," 5384"," 6336"," 6168"," 6250"," 6357"," 6702"," 7187"," 6574"," 7987"," 7616"," 7604"," 7511"," 6927"," 6706"," 6560"," 7503"," 6367"," 7680"," 7846"," 7515"," 7354"," 7977"," 7224"," 7112"," 7732"," 8170"," 6553"," 7530"," 7697"," 7107"," 7408"," 7514"," 8334"," 8259"," 7722"," 8979"," 9288"," 9251","11534","11582","11558","11478","12982","12291","12096","13915","13519","12383","11346","11594","11271","10430","11715","11770","10921","11680","10634","12305","12723","11288","10489","10623"," 9959","10092"," 9296"," 9114","10225","11622","10867","10351","10003","10207","10770","11054"," 8128","11917","10848","10903","10432","10784","12305","11852","12499"],[" 4306"," 4976"," 4664"," 4616"," 4596"," 4393"," 4618"," 5038"," 5333"," 4836"," 5240"," 5437"," 5222"," 5405"," 5483"," 5351"," 6199"," 6041"," 6529"," 6280"," 6357"," 5967"," 6968"," 7338"," 7171"," 7478"," 7784"," 7413"," 7208"," 7817"," 7769"," 7747"," 7377"," 7897"," 8085"," 7816"," 8457"," 7812"," 7879"," 7523"," 7954"," 8113"," 7981"," 7737"," 8232"," 7618"," 8156"," 7727"," 8718"," 8539"," 9907"," 9390"," 9337"," 9266"," 9981","10635","12040","12971","12447","13450","13684","14333","13502","12758","14351","13606","13775","12226","12692","12376","12217","12115","11043","12757","12442","12140","12827","12261","11049","10715"," 9595","11572","11247","11162","11843","11292","12449","11285","10377","11884","11240","11222","12457","12347","12570","13306","12832","12355","14171","13047","13862"],[" 4293"," 4531"," 4523"," 4492"," 4363"," 4343"," 4614"," 4656"," 4803"," 4736"," 4704"," 4511"," 4918"," 5112"," 5335"," 5186"," 5660"," 5611"," 5736"," 5683"," 6203"," 6080"," 6563"," 7006"," 6975"," 7210"," 7652"," 7981"," 6738"," 7180"," 7521"," 7774"," 7401"," 7340"," 7307"," 7351"," 7684"," 7899"," 7360"," 7495"," 7622"," 7672"," 7824"," 7664"," 7703"," 7654"," 7827"," 7700"," 8390"," 8804"," 8924"," 9606","10503","10470","11843","11733","13142","13227","12819","14155","14737","15188","14664","15075","14112","15172","14490","14274","12350","13618","13090","13050","12428","13289","13046","13245","13089","12345","12463","12897","12571","13071","12108","11756","12704","12941","12416","12782","13330","12875","13106","13313","14064","13614","13895","14156","14486","14686","14848","14730","14671"],[" 4776"," 4541"," 3999"," 4785"," 3995"," 4186"," 4498"," 5194"," 4904"," 4988"," 5287"," 5575"," 5183"," 5168"," 5778"," 5337"," 6037"," 6297"," 6235"," 6940"," 6273"," 6391"," 7139"," 7227"," 7683"," 7649"," 7765"," 7523"," 7974"," 7763"," 8135"," 7748"," 7652"," 7670"," 7498"," 8158"," 7149"," 8186"," 7970"," 7673"," 8504"," 7929"," 6889"," 8699"," 6794"," 7804"," 7930"," 8483"," 8538"," 8859"," 9204"," 9195"," 9696","10010","11009","11417","13594","13052","13531","14620","13803","14636","14980","15060","15742","15631","14978","14107","13379","14241","12633","12408","13803","13008","13757","13049","11718","13202","13278","14399","12378","11479","13423","10152","11490","12625","12024","12787","12276","13462","13202","14568","14081","13788","13227","13870","14070","14084","15859","14014","13549"],[" 4638"," 4674"," 3907"," 3790"," 4068"," 4331"," 4523"," 4352"," 4720"," 4893"," 4747"," 4649"," 4441"," 4395"," 5651"," 5086"," 5806"," 5249"," 5294"," 5277"," 6193"," 5800"," 5762"," 5667"," 5783"," 6663"," 6619"," 6598"," 7185"," 6617"," 6877"," 6684"," 5594"," 7177"," 7679"," 7639"," 6821"," 7334"," 7513"," 7667"," 6719"," 7773"," 7162"," 7821"," 6755"," 7242"," 7897"," 8547"," 7227"," 9081"," 7778"," 8321"," 8378","10310","10172","11158","11181","10666","12220","12711","14315","13004","12074","12681","12695","12952","12564","12204","11798","11502","11862","11146","10229","10993","11326","12079","12004","11416","10123","11258","10624","12234"," 9515","11258","10398"," 9611","11206","11012"," 9397","11687","10944","11626","11067"," 9857"," 9846","12835","11173","12016","12148","12761","12256"]],"fixedtz":false,"tzone":"UTC"},"evals":[],"jsHooks":[]}</script>
<p>Nice interactive graph where you can select to zoom in and hover. Its abit messy showing too many timelines at once. Normally around 3 timelines is the max to show in the same graph. But for completeness all postal areas for Odense will be shown. The hovering helps examining the individual postal codes.<br />
When you look at the graphs, you can see the house bubble from around 2004 to 2007, where each postal district increased the average price by about 75%. After 2008 the prices havent really burst but rather been fluctuating with alot of variance, and each district also seem to be more spread apart.</p>
<p>Notice that normally you can add an interactive rangeselector, but this gets messed up in this hugo-website. Probably a .css battle going on in the background.</p>
<p>Next step is using Facebooks prophet function, to predict the coming changes.</p>
<pre class="r"><code># face prophesying

it &lt;- colnames(gbm011[,-1])
# predictions for a single postal district
prophesying &lt;- function(x, df, datecol=&quot;date&quot;, preds=20, freq=&quot;quarter&quot;){
    df2 &lt;- df[,c(datecol, x)]
    colnames(df2) &lt;- c(&quot;ds&quot;, &quot;y&quot;)
    m &lt;- prophet(df2)
    future &lt;- make_future_dataframe(m, preds+1, freq=freq, include_history=FALSE)
    forecast &lt;- predict(m, future)
    retur &lt;- data_frame(forecast$ds, forecast$yhat)
    colnames(retur) &lt;- c(datecol, x)
    retur
}
# applying predictions for all districts, have to use capture.output to prevent prophet spam. 
dummy &lt;- capture.output(prop_list &lt;- map(it, prophesying, gbm011))
prop_df &lt;- reduce(prop_list, left_join, by=&quot;date&quot;)
prop_df[,-1] &lt;- map_df(prop_df[,-1], as.integer)

# make timeseries object
prop_df &lt;- dplyr::union(gbm011, prop_df) %&gt;% arrange(date)
bm_prop_xts &lt;- xts(prop_df, order.by=prop_df$date)</code></pre>
<p>The prophet function, can only predict one timeseries at a time, so it cant incorporate dependencies among the postal district, which you would expect there to be for real estate prices, in neighboring districts.</p>
<pre class="r"><code># plot prices with prophet predictions for 5 years
dyg &lt;- dygraph(bm_prop_xts, main=&quot;Odense m2 prices for each postal area&quot;) %&gt;%
    dyHighlight(highlightSeriesOpts = list(strokeWidth = 3)) %&gt;% 
    dyLegend(width=720) %&gt;% 
    dyOptions(colors = brewer.pal(9, &quot;Set1&quot;), drawGrid=FALSE) %&gt;% 
    dyShading(from = gbm011$date[nrow(gbm011)], to = prop_df$date[nrow(prop_df)], color = &quot;#CCEBD6&quot;)
    # %&gt;% dyRangeSelector(fillColor=&quot;&quot;, strokeColor=&quot;&quot;)
dyg</code></pre>
<div id="htmlwidget-420c57dec178002216a9" style="width:768px;height:480px;" class="dygraphs html-widget"></div>
<script type="application/json" data-for="htmlwidget-420c57dec178002216a9">{"x":{"attrs":{"title":"Odense m2 prices for each postal area","labels":["quarter","date","C","M","N","NV","NØ","S","SV","SØ","V"],"retainDateWindow":false,"axes":{"x":{"pixelsPerLabel":60,"drawAxis":true},"y":{"drawAxis":true}},"highlightCircleSize":3,"highlightSeriesBackgroundAlpha":0.5,"highlightSeriesOpts":{"strokeWidth":3},"legend":"auto","labelsDivWidth":720,"labelsShowZeroValues":true,"labelsSeparateLines":false,"hideOverlayOnMouseOut":true,"stackedGraph":false,"fillGraph":false,"fillAlpha":0.15,"stepPlot":false,"drawPoints":false,"pointSize":1,"drawGapEdgePoints":false,"connectSeparatedPoints":false,"strokeWidth":1,"strokeBorderColor":"white","colors":["#E41A1C","#377EB8","#4DAF4A","#984EA3","#FF7F00","#FFFF33","#A65628","#F781BF","#999999"],"colorValue":0.5,"colorSaturation":1,"includeZero":false,"drawAxesAtZero":false,"logscale":false,"axisTickSize":3,"axisLineColor":"black","axisLineWidth":0.3,"axisLabelColor":"black","axisLabelFontSize":14,"axisLabelWidth":60,"drawGrid":false,"gridLineWidth":0.3,"rightGap":5,"digitsAfterDecimal":2,"labelsKMB":false,"labelsKMG2":false,"labelsUTC":false,"maxNumberWidth":6,"animatedZooms":false,"mobileDisableYTouch":true},"scale":"quarterly","annotations":[],"shadings":[{"from":"2017-04-01T00:00:00.000Z","to":"2022-04-01T00:00:00.000Z","color":"#CCEBD6","axis":"x"}],"events":[],"format":"date","data":[["1992-04-01T00:00:00.000Z","1992-07-01T00:00:00.000Z","1992-10-01T00:00:00.000Z","1993-01-01T00:00:00.000Z","1993-04-01T00:00:00.000Z","1993-07-01T00:00:00.000Z","1993-10-01T00:00:00.000Z","1994-01-01T00:00:00.000Z","1994-04-01T00:00:00.000Z","1994-07-01T00:00:00.000Z","1994-10-01T00:00:00.000Z","1995-01-01T00:00:00.000Z","1995-04-01T00:00:00.000Z","1995-07-01T00:00:00.000Z","1995-10-01T00:00:00.000Z","1996-01-01T00:00:00.000Z","1996-04-01T00:00:00.000Z","1996-07-01T00:00:00.000Z","1996-10-01T00:00:00.000Z","1997-01-01T00:00:00.000Z","1997-04-01T00:00:00.000Z","1997-07-01T00:00:00.000Z","1997-10-01T00:00:00.000Z","1998-01-01T00:00:00.000Z","1998-04-01T00:00:00.000Z","1998-07-01T00:00:00.000Z","1998-10-01T00:00:00.000Z","1999-01-01T00:00:00.000Z","1999-04-01T00:00:00.000Z","1999-07-01T00:00:00.000Z","1999-10-01T00:00:00.000Z","2000-01-01T00:00:00.000Z","2000-04-01T00:00:00.000Z","2000-07-01T00:00:00.000Z","2000-10-01T00:00:00.000Z","2001-01-01T00:00:00.000Z","2001-04-01T00:00:00.000Z","2001-07-01T00:00:00.000Z","2001-10-01T00:00:00.000Z","2002-01-01T00:00:00.000Z","2002-04-01T00:00:00.000Z","2002-07-01T00:00:00.000Z","2002-10-01T00:00:00.000Z","2003-01-01T00:00:00.000Z","2003-04-01T00:00:00.000Z","2003-07-01T00:00:00.000Z","2003-10-01T00:00:00.000Z","2004-01-01T00:00:00.000Z","2004-04-01T00:00:00.000Z","2004-07-01T00:00:00.000Z","2004-10-01T00:00:00.000Z","2005-01-01T00:00:00.000Z","2005-04-01T00:00:00.000Z","2005-07-01T00:00:00.000Z","2005-10-01T00:00:00.000Z","2006-01-01T00:00:00.000Z","2006-04-01T00:00:00.000Z","2006-07-01T00:00:00.000Z","2006-10-01T00:00:00.000Z","2007-01-01T00:00:00.000Z","2007-04-01T00:00:00.000Z","2007-07-01T00:00:00.000Z","2007-10-01T00:00:00.000Z","2008-01-01T00:00:00.000Z","2008-04-01T00:00:00.000Z","2008-07-01T00:00:00.000Z","2008-10-01T00:00:00.000Z","2009-01-01T00:00:00.000Z","2009-04-01T00:00:00.000Z","2009-07-01T00:00:00.000Z","2009-10-01T00:00:00.000Z","2010-01-01T00:00:00.000Z","2010-04-01T00:00:00.000Z","2010-07-01T00:00:00.000Z","2010-10-01T00:00:00.000Z","2011-01-01T00:00:00.000Z","2011-04-01T00:00:00.000Z","2011-07-01T00:00:00.000Z","2011-10-01T00:00:00.000Z","2012-01-01T00:00:00.000Z","2012-04-01T00:00:00.000Z","2012-07-01T00:00:00.000Z","2012-10-01T00:00:00.000Z","2013-01-01T00:00:00.000Z","2013-04-01T00:00:00.000Z","2013-07-01T00:00:00.000Z","2013-10-01T00:00:00.000Z","2014-01-01T00:00:00.000Z","2014-04-01T00:00:00.000Z","2014-07-01T00:00:00.000Z","2014-10-01T00:00:00.000Z","2015-01-01T00:00:00.000Z","2015-04-01T00:00:00.000Z","2015-07-01T00:00:00.000Z","2015-10-01T00:00:00.000Z","2016-01-01T00:00:00.000Z","2016-04-01T00:00:00.000Z","2016-07-01T00:00:00.000Z","2016-10-01T00:00:00.000Z","2017-01-01T00:00:00.000Z","2017-04-01T00:00:00.000Z","2017-07-01T00:00:00.000Z","2017-10-01T00:00:00.000Z","2018-01-01T00:00:00.000Z","2018-04-01T00:00:00.000Z","2018-07-01T00:00:00.000Z","2018-10-01T00:00:00.000Z","2019-01-01T00:00:00.000Z","2019-04-01T00:00:00.000Z","2019-07-01T00:00:00.000Z","2019-10-01T00:00:00.000Z","2020-01-01T00:00:00.000Z","2020-04-01T00:00:00.000Z","2020-07-01T00:00:00.000Z","2020-10-01T00:00:00.000Z","2021-01-01T00:00:00.000Z","2021-04-01T00:00:00.000Z","2021-07-01T00:00:00.000Z","2021-10-01T00:00:00.000Z","2022-01-01T00:00:00.000Z","2022-04-01T00:00:00.000Z"],["1992-04-01","1992-07-01","1992-10-01","1993-01-01","1993-04-01","1993-07-01","1993-10-01","1994-01-01","1994-04-01","1994-07-01","1994-10-01","1995-01-01","1995-04-01","1995-07-01","1995-10-01","1996-01-01","1996-04-01","1996-07-01","1996-10-01","1997-01-01","1997-04-01","1997-07-01","1997-10-01","1998-01-01","1998-04-01","1998-07-01","1998-10-01","1999-01-01","1999-04-01","1999-07-01","1999-10-01","2000-01-01","2000-04-01","2000-07-01","2000-10-01","2001-01-01","2001-04-01","2001-07-01","2001-10-01","2002-01-01","2002-04-01","2002-07-01","2002-10-01","2003-01-01","2003-04-01","2003-07-01","2003-10-01","2004-01-01","2004-04-01","2004-07-01","2004-10-01","2005-01-01","2005-04-01","2005-07-01","2005-10-01","2006-01-01","2006-04-01","2006-07-01","2006-10-01","2007-01-01","2007-04-01","2007-07-01","2007-10-01","2008-01-01","2008-04-01","2008-07-01","2008-10-01","2009-01-01","2009-04-01","2009-07-01","2009-10-01","2010-01-01","2010-04-01","2010-07-01","2010-10-01","2011-01-01","2011-04-01","2011-07-01","2011-10-01","2012-01-01","2012-04-01","2012-07-01","2012-10-01","2013-01-01","2013-04-01","2013-07-01","2013-10-01","2014-01-01","2014-04-01","2014-07-01","2014-10-01","2015-01-01","2015-04-01","2015-07-01","2015-10-01","2016-01-01","2016-04-01","2016-07-01","2016-10-01","2017-01-01","2017-04-01","2017-07-01","2017-10-01","2018-01-01","2018-04-01","2018-07-01","2018-10-01","2019-01-01","2019-04-01","2019-07-01","2019-10-01","2020-01-01","2020-04-01","2020-07-01","2020-10-01","2021-01-01","2021-04-01","2021-07-01","2021-10-01","2022-01-01","2022-04-01"],[" 4010"," 4001"," 3951"," 3884"," 3878"," 3872"," 4055"," 3970"," 4335"," 4595"," 4156"," 4291"," 4548"," 4725"," 4628"," 4917"," 4607"," 5246"," 5424"," 5445"," 5918"," 5956"," 6082"," 5619"," 6526"," 6697"," 7039"," 6909"," 6926"," 6954"," 7480"," 6659"," 6815"," 7013"," 6867"," 7142"," 7213"," 7353"," 7628"," 7516"," 7446"," 7932"," 7645"," 7622"," 7605"," 7348"," 8303"," 8734"," 8194"," 9886"," 9689"," 9763","10179","10713","11891","14054","13969","14211","14005","15304","14827","15503","15883","16027","15444","16445","16412","14226","14563","14505","14101","13325","15631","15552","14131","14356","14308","13946","14578","13764","12171","14471","14072","15301","13878","13401","14833","14485","14456","15405","14647","16460","15562","15977","16564","15062","17326","14775","15824","17272","16844","17009","17229","16793","17388","17566","17180","17448","17358","17483","17888","17971","17980","18266","18394","18142","18535","18767","18476","18817","18635"],[" 4459"," 4466"," 4452"," 4518"," 4151"," 4538"," 4759"," 4393"," 5006"," 5022"," 5306"," 5082"," 5482"," 5357"," 5811"," 5624"," 5429"," 6194"," 5995"," 6261"," 6664"," 7346"," 6842"," 7810"," 6875"," 8455"," 7779"," 7898"," 7885"," 8284"," 7858"," 9183"," 8161"," 8499"," 8127"," 8396"," 8681"," 8593"," 8768"," 8772"," 8228"," 8889"," 9147"," 9418"," 8661"," 8980"," 9197"," 9652","10281","10206"," 9840","10362","12193","12334","14046","14817","16226","15962","18492","18209","18324","17429","15168","20233","15590","17461","18274","17437","14146","15838","17101","15378","14296","15728","16499","16173","14935","15373","14381","14231","14751","15287","16815","15380","14631","16793","16181","16101","15922","16748","15976","15384","15779","17662","17476","17469","17417","18662","18158","17878","18905","18587","18898","18136","18690","19236","18449","18777","18338","18877","18942","19211","18791","19350","19478","19336","19175","19727","19797","20195","19589"],[" 4444"," 4432"," 4554"," 4470"," 4396"," 4352"," 4905"," 4624"," 5242"," 5179"," 4913"," 5086"," 5355"," 5193"," 5766"," 5387"," 5833"," 5998"," 6242"," 6150"," 6670"," 6714"," 6176"," 6699"," 7145"," 7061"," 7177"," 7590"," 7113"," 7357"," 7322"," 7391"," 7077"," 7218"," 7848"," 7457"," 7311"," 7466"," 7564"," 7003"," 7835"," 7816"," 7762"," 7638"," 7988"," 7396"," 7477"," 7476"," 7849"," 8496"," 8025"," 8112"," 8836"," 9412","10183","10617","11236","11682","12117","13064","13409","13637","13316","12366","13856","14423","12894","12969","13335","12348","11757","12429","12276","12364","11093","11800","11758","11982","11747","10174","10744","11064","11994","10727","10992","10928","10918","11220","11113","10946","12197","11783","11827","12431","12252","12695","12379","12610","12194","11210","12925","12431","12497","12246","12684","12689","12523","12270","12731","12709","12539","12640","12838","12895","12646","12515","12812","12842","12801","12636","12988"],[" 4376"," 4530"," 4929"," 4471"," 4418"," 4680"," 4851"," 4460"," 4617"," 4811"," 5010"," 5048"," 5333"," 5512"," 5311"," 5382"," 5498"," 5705"," 6033"," 6182"," 6449"," 6638"," 6930"," 6436"," 6887"," 7166"," 7643"," 7649"," 7679"," 7279"," 7545"," 7764"," 7127"," 7534"," 7613"," 7628"," 8500"," 8041"," 7688"," 7550"," 7893"," 7756"," 7313"," 7504"," 7475"," 8049"," 7729"," 7506"," 8183"," 8335"," 8516"," 8318"," 9305"," 9960","10562","11439","11954","12856","12594","13046","13719","14401","13918","13374","13612","13982","14339","13501","11459","12000","12598","12398","13026","12310","12677","12934","12807","11775","11314","10876","11239","11673","11291","11700","10703","11224","11558","11290","10752","11701","11713","11421","12173","12474","12476","12096","12654","12767","13559","13329","11120","12812","13309","12462","13214","13397","12717","12596","12747","12883","12847","12775","12736","13017","13218","13023","12996","13228","13285","13159","13189"],[" 4417"," 4428"," 4509"," 3718"," 4175"," 4727"," 4402"," 4530"," 5399"," 4812"," 4823"," 4796"," 4977"," 4825"," 5695"," 5427"," 5668"," 5452"," 5384"," 6336"," 6168"," 6250"," 6357"," 6702"," 7187"," 6574"," 7987"," 7616"," 7604"," 7511"," 6927"," 6706"," 6560"," 7503"," 6367"," 7680"," 7846"," 7515"," 7354"," 7977"," 7224"," 7112"," 7732"," 8170"," 6553"," 7530"," 7697"," 7107"," 7408"," 7514"," 8334"," 8259"," 7722"," 8979"," 9288"," 9251","11534","11582","11558","11478","12982","12291","12096","13915","13519","12383","11346","11594","11271","10430","11715","11770","10921","11680","10634","12305","12723","11288","10489","10623"," 9959","10092"," 9296"," 9114","10225","11622","10867","10351","10003","10207","10770","11054"," 8128","11917","10848","10903","10432","10784","12305","11852","12499","11562","11508","11259","11606","11705","11271","11540","11355","11491","11532","11546","11373","11399","11518","11462","11629","11693","11494","11886","11592"],[" 4306"," 4976"," 4664"," 4616"," 4596"," 4393"," 4618"," 5038"," 5333"," 4836"," 5240"," 5437"," 5222"," 5405"," 5483"," 5351"," 6199"," 6041"," 6529"," 6280"," 6357"," 5967"," 6968"," 7338"," 7171"," 7478"," 7784"," 7413"," 7208"," 7817"," 7769"," 7747"," 7377"," 7897"," 8085"," 7816"," 8457"," 7812"," 7879"," 7523"," 7954"," 8113"," 7981"," 7737"," 8232"," 7618"," 8156"," 7727"," 8718"," 8539"," 9907"," 9390"," 9337"," 9266"," 9981","10635","12040","12971","12447","13450","13684","14333","13502","12758","14351","13606","13775","12226","12692","12376","12217","12115","11043","12757","12442","12140","12827","12261","11049","10715"," 9595","11572","11247","11162","11843","11292","12449","11285","10377","11884","11240","11222","12457","12347","12570","13306","12832","12355","14171","13047","13862","13120","13266","12734","13234","13314","13098","12752","13142","13257","13049","13108","13283","13297","13355","13237","13246","13293","13667","13564","13635"],[" 4293"," 4531"," 4523"," 4492"," 4363"," 4343"," 4614"," 4656"," 4803"," 4736"," 4704"," 4511"," 4918"," 5112"," 5335"," 5186"," 5660"," 5611"," 5736"," 5683"," 6203"," 6080"," 6563"," 7006"," 6975"," 7210"," 7652"," 7981"," 6738"," 7180"," 7521"," 7774"," 7401"," 7340"," 7307"," 7351"," 7684"," 7899"," 7360"," 7495"," 7622"," 7672"," 7824"," 7664"," 7703"," 7654"," 7827"," 7700"," 8390"," 8804"," 8924"," 9606","10503","10470","11843","11733","13142","13227","12819","14155","14737","15188","14664","15075","14112","15172","14490","14274","12350","13618","13090","13050","12428","13289","13046","13245","13089","12345","12463","12897","12571","13071","12108","11756","12704","12941","12416","12782","13330","12875","13106","13313","14064","13614","13895","14156","14486","14686","14848","14730","14671","14884","14965","14417","15172","15266","14608","14701","14842","14874","14856","15203","15208","15423","15221","15414","15402","15556","15643","15876","15849"],[" 4776"," 4541"," 3999"," 4785"," 3995"," 4186"," 4498"," 5194"," 4904"," 4988"," 5287"," 5575"," 5183"," 5168"," 5778"," 5337"," 6037"," 6297"," 6235"," 6940"," 6273"," 6391"," 7139"," 7227"," 7683"," 7649"," 7765"," 7523"," 7974"," 7763"," 8135"," 7748"," 7652"," 7670"," 7498"," 8158"," 7149"," 8186"," 7970"," 7673"," 8504"," 7929"," 6889"," 8699"," 6794"," 7804"," 7930"," 8483"," 8538"," 8859"," 9204"," 9195"," 9696","10010","11009","11417","13594","13052","13531","14620","13803","14636","14980","15060","15742","15631","14978","14107","13379","14241","12633","12408","13803","13008","13757","13049","11718","13202","13278","14399","12378","11479","13423","10152","11490","12625","12024","12787","12276","13462","13202","14568","14081","13788","13227","13870","14070","14084","15859","14014","13549","14637","14774","14542","14713","14945","14743","14499","14688","14991","14539","15591","15323","15412","15193","14900","15126","15287","15260","15632","15200"],[" 4638"," 4674"," 3907"," 3790"," 4068"," 4331"," 4523"," 4352"," 4720"," 4893"," 4747"," 4649"," 4441"," 4395"," 5651"," 5086"," 5806"," 5249"," 5294"," 5277"," 6193"," 5800"," 5762"," 5667"," 5783"," 6663"," 6619"," 6598"," 7185"," 6617"," 6877"," 6684"," 5594"," 7177"," 7679"," 7639"," 6821"," 7334"," 7513"," 7667"," 6719"," 7773"," 7162"," 7821"," 6755"," 7242"," 7897"," 8547"," 7227"," 9081"," 7778"," 8321"," 8378","10310","10172","11158","11181","10666","12220","12711","14315","13004","12074","12681","12695","12952","12564","12204","11798","11502","11862","11146","10229","10993","11326","12079","12004","11416","10123","11258","10624","12234"," 9515","11258","10398"," 9611","11206","11012"," 9397","11687","10944","11626","11067"," 9857"," 9846","12835","11173","12016","12148","12761","12256","11765","12420","11641","12453","12567","11460","11972","11604","11498","11700","12193","11673","12222","11764","12165","11690","12021","12076","12160","12109"]],"fixedtz":false,"tzone":"UTC"},"evals":[],"jsHooks":[]}</script>
<p>Above is the graph including the prophet predictions shown in green.</p>
<p>Next step is to show how the postal districts have spread from each other.</p>
<pre class="r"><code>prop_d &lt;- prop_df$date
prop_m &lt;- as.matrix(prop_df[,-1])
prop_mean &lt;- rowSums(prop_m)/ncol(prop_m)
# adjusting each year
prop_m2 &lt;- prop_m/prop_mean
prop_m2_c2 &lt;- (prop_m2 - 1)^2
prop_m2_var &lt;- rowSums(prop_m2_c2)/ncol(prop_m2)
prop_m2_sd &lt;- prop_m2_var^0.5
change2 &lt;- data_frame(date=prop_d, sd=prop_m2_sd)

# plot shows that the difference between the postal regions have increased, which is also clear from the earlier plots
ggplot(change2, aes(x=date, y=sd)) + 
    geom_line() +
    geom_smooth(method=&quot;loess&quot;)</code></pre>
<p><img src="/post/2017-07-23-facebooks-prophet_files/figure-html/unnamed-chunk-1-1.png" width="768" /></p>
<p>From the graph it seems that the spread between the postal districts starts to happen around the time the bubble starts. This can be explained by some of the districts reacting quicker to market changes. But that dosnt explain that the spread continues after bubble has faded out. That could be the object of another analysis.</p>
<p>Last step is to prettify the graph, by adjusting with a moving average to make the graphs more smooth.</p>
<pre class="r"><code># smooth by using moving average
prop_df_s &lt;- prop_df
prop_df_s[,-1] &lt;- rollapplyr(prop_df_s[,-1], 4, mean, partial=TRUE)
prop_df_s[,-1] &lt;- map_df(prop_df_s[,-1], as.integer)
bm_prop_xts_s &lt;- xts(prop_df_s, order.by=prop_df_s$date)
dyg &lt;- dygraph(bm_prop_xts_s, main=&quot;Odense m2 prices for each postal area smoothed to yearly average&quot;) %&gt;%
    dyHighlight(highlightSeriesOpts = list(strokeWidth = 3)) %&gt;% 
    dyLegend(width=720) %&gt;% 
    dyOptions(colors = brewer.pal(9, &quot;Set1&quot;), drawGrid=FALSE) %&gt;% 
    dyShading(from = gbm011$date[nrow(gbm011)], to = prop_df$date[nrow(prop_df_s)], color = &quot;#CCEBD6&quot;)
    # %&gt;% dyRangeSelector(fillColor=&quot;&quot;, strokeColor=&quot;&quot;)
dyg</code></pre>
<div id="htmlwidget-e4292c61533651de8d1d" style="width:768px;height:480px;" class="dygraphs html-widget"></div>
<script type="application/json" data-for="htmlwidget-e4292c61533651de8d1d">{"x":{"attrs":{"title":"Odense m2 prices for each postal area smoothed to yearly average","labels":["quarter","date","C","M","N","NV","NØ","S","SV","SØ","V"],"retainDateWindow":false,"axes":{"x":{"pixelsPerLabel":60,"drawAxis":true},"y":{"drawAxis":true}},"highlightCircleSize":3,"highlightSeriesBackgroundAlpha":0.5,"highlightSeriesOpts":{"strokeWidth":3},"legend":"auto","labelsDivWidth":720,"labelsShowZeroValues":true,"labelsSeparateLines":false,"hideOverlayOnMouseOut":true,"stackedGraph":false,"fillGraph":false,"fillAlpha":0.15,"stepPlot":false,"drawPoints":false,"pointSize":1,"drawGapEdgePoints":false,"connectSeparatedPoints":false,"strokeWidth":1,"strokeBorderColor":"white","colors":["#E41A1C","#377EB8","#4DAF4A","#984EA3","#FF7F00","#FFFF33","#A65628","#F781BF","#999999"],"colorValue":0.5,"colorSaturation":1,"includeZero":false,"drawAxesAtZero":false,"logscale":false,"axisTickSize":3,"axisLineColor":"black","axisLineWidth":0.3,"axisLabelColor":"black","axisLabelFontSize":14,"axisLabelWidth":60,"drawGrid":false,"gridLineWidth":0.3,"rightGap":5,"digitsAfterDecimal":2,"labelsKMB":false,"labelsKMG2":false,"labelsUTC":false,"maxNumberWidth":6,"animatedZooms":false,"mobileDisableYTouch":true},"scale":"quarterly","annotations":[],"shadings":[{"from":"2017-04-01T00:00:00.000Z","to":"2022-04-01T00:00:00.000Z","color":"#CCEBD6","axis":"x"}],"events":[],"format":"date","data":[["1992-04-01T00:00:00.000Z","1992-07-01T00:00:00.000Z","1992-10-01T00:00:00.000Z","1993-01-01T00:00:00.000Z","1993-04-01T00:00:00.000Z","1993-07-01T00:00:00.000Z","1993-10-01T00:00:00.000Z","1994-01-01T00:00:00.000Z","1994-04-01T00:00:00.000Z","1994-07-01T00:00:00.000Z","1994-10-01T00:00:00.000Z","1995-01-01T00:00:00.000Z","1995-04-01T00:00:00.000Z","1995-07-01T00:00:00.000Z","1995-10-01T00:00:00.000Z","1996-01-01T00:00:00.000Z","1996-04-01T00:00:00.000Z","1996-07-01T00:00:00.000Z","1996-10-01T00:00:00.000Z","1997-01-01T00:00:00.000Z","1997-04-01T00:00:00.000Z","1997-07-01T00:00:00.000Z","1997-10-01T00:00:00.000Z","1998-01-01T00:00:00.000Z","1998-04-01T00:00:00.000Z","1998-07-01T00:00:00.000Z","1998-10-01T00:00:00.000Z","1999-01-01T00:00:00.000Z","1999-04-01T00:00:00.000Z","1999-07-01T00:00:00.000Z","1999-10-01T00:00:00.000Z","2000-01-01T00:00:00.000Z","2000-04-01T00:00:00.000Z","2000-07-01T00:00:00.000Z","2000-10-01T00:00:00.000Z","2001-01-01T00:00:00.000Z","2001-04-01T00:00:00.000Z","2001-07-01T00:00:00.000Z","2001-10-01T00:00:00.000Z","2002-01-01T00:00:00.000Z","2002-04-01T00:00:00.000Z","2002-07-01T00:00:00.000Z","2002-10-01T00:00:00.000Z","2003-01-01T00:00:00.000Z","2003-04-01T00:00:00.000Z","2003-07-01T00:00:00.000Z","2003-10-01T00:00:00.000Z","2004-01-01T00:00:00.000Z","2004-04-01T00:00:00.000Z","2004-07-01T00:00:00.000Z","2004-10-01T00:00:00.000Z","2005-01-01T00:00:00.000Z","2005-04-01T00:00:00.000Z","2005-07-01T00:00:00.000Z","2005-10-01T00:00:00.000Z","2006-01-01T00:00:00.000Z","2006-04-01T00:00:00.000Z","2006-07-01T00:00:00.000Z","2006-10-01T00:00:00.000Z","2007-01-01T00:00:00.000Z","2007-04-01T00:00:00.000Z","2007-07-01T00:00:00.000Z","2007-10-01T00:00:00.000Z","2008-01-01T00:00:00.000Z","2008-04-01T00:00:00.000Z","2008-07-01T00:00:00.000Z","2008-10-01T00:00:00.000Z","2009-01-01T00:00:00.000Z","2009-04-01T00:00:00.000Z","2009-07-01T00:00:00.000Z","2009-10-01T00:00:00.000Z","2010-01-01T00:00:00.000Z","2010-04-01T00:00:00.000Z","2010-07-01T00:00:00.000Z","2010-10-01T00:00:00.000Z","2011-01-01T00:00:00.000Z","2011-04-01T00:00:00.000Z","2011-07-01T00:00:00.000Z","2011-10-01T00:00:00.000Z","2012-01-01T00:00:00.000Z","2012-04-01T00:00:00.000Z","2012-07-01T00:00:00.000Z","2012-10-01T00:00:00.000Z","2013-01-01T00:00:00.000Z","2013-04-01T00:00:00.000Z","2013-07-01T00:00:00.000Z","2013-10-01T00:00:00.000Z","2014-01-01T00:00:00.000Z","2014-04-01T00:00:00.000Z","2014-07-01T00:00:00.000Z","2014-10-01T00:00:00.000Z","2015-01-01T00:00:00.000Z","2015-04-01T00:00:00.000Z","2015-07-01T00:00:00.000Z","2015-10-01T00:00:00.000Z","2016-01-01T00:00:00.000Z","2016-04-01T00:00:00.000Z","2016-07-01T00:00:00.000Z","2016-10-01T00:00:00.000Z","2017-01-01T00:00:00.000Z","2017-04-01T00:00:00.000Z","2017-07-01T00:00:00.000Z","2017-10-01T00:00:00.000Z","2018-01-01T00:00:00.000Z","2018-04-01T00:00:00.000Z","2018-07-01T00:00:00.000Z","2018-10-01T00:00:00.000Z","2019-01-01T00:00:00.000Z","2019-04-01T00:00:00.000Z","2019-07-01T00:00:00.000Z","2019-10-01T00:00:00.000Z","2020-01-01T00:00:00.000Z","2020-04-01T00:00:00.000Z","2020-07-01T00:00:00.000Z","2020-10-01T00:00:00.000Z","2021-01-01T00:00:00.000Z","2021-04-01T00:00:00.000Z","2021-07-01T00:00:00.000Z","2021-10-01T00:00:00.000Z","2022-01-01T00:00:00.000Z","2022-04-01T00:00:00.000Z"],["1992-04-01","1992-07-01","1992-10-01","1993-01-01","1993-04-01","1993-07-01","1993-10-01","1994-01-01","1994-04-01","1994-07-01","1994-10-01","1995-01-01","1995-04-01","1995-07-01","1995-10-01","1996-01-01","1996-04-01","1996-07-01","1996-10-01","1997-01-01","1997-04-01","1997-07-01","1997-10-01","1998-01-01","1998-04-01","1998-07-01","1998-10-01","1999-01-01","1999-04-01","1999-07-01","1999-10-01","2000-01-01","2000-04-01","2000-07-01","2000-10-01","2001-01-01","2001-04-01","2001-07-01","2001-10-01","2002-01-01","2002-04-01","2002-07-01","2002-10-01","2003-01-01","2003-04-01","2003-07-01","2003-10-01","2004-01-01","2004-04-01","2004-07-01","2004-10-01","2005-01-01","2005-04-01","2005-07-01","2005-10-01","2006-01-01","2006-04-01","2006-07-01","2006-10-01","2007-01-01","2007-04-01","2007-07-01","2007-10-01","2008-01-01","2008-04-01","2008-07-01","2008-10-01","2009-01-01","2009-04-01","2009-07-01","2009-10-01","2010-01-01","2010-04-01","2010-07-01","2010-10-01","2011-01-01","2011-04-01","2011-07-01","2011-10-01","2012-01-01","2012-04-01","2012-07-01","2012-10-01","2013-01-01","2013-04-01","2013-07-01","2013-10-01","2014-01-01","2014-04-01","2014-07-01","2014-10-01","2015-01-01","2015-04-01","2015-07-01","2015-10-01","2016-01-01","2016-04-01","2016-07-01","2016-10-01","2017-01-01","2017-04-01","2017-07-01","2017-10-01","2018-01-01","2018-04-01","2018-07-01","2018-10-01","2019-01-01","2019-04-01","2019-07-01","2019-10-01","2020-01-01","2020-04-01","2020-07-01","2020-10-01","2021-01-01","2021-04-01","2021-07-01","2021-10-01","2022-01-01","2022-04-01"],[" 4010"," 4005"," 3987"," 3961"," 3928"," 3896"," 3922"," 3943"," 4058"," 4238"," 4264"," 4344"," 4397"," 4430"," 4548"," 4704"," 4719"," 4849"," 5048"," 5180"," 5508"," 5685"," 5850"," 5893"," 6045"," 6231"," 6470"," 6792"," 6892"," 6957"," 7067"," 7004"," 6977"," 6991"," 6838"," 6959"," 7058"," 7143"," 7334"," 7427"," 7485"," 7630"," 7634"," 7661"," 7701"," 7555"," 7719"," 7997"," 8144"," 8779"," 9125"," 9383"," 9879","10086","10636","11709","12656","13531","14059","14372","14586","14909","15379","15560","15714","15949","16082","15631","15411","14926","14348","14123","14390","14652","14659","14917","14586","14185","14297","14149","13614","13746","13619","14003","14430","14163","14353","14149","14293","14794","14748","15242","15518","15661","16140","15791","16232","15931","15746","16299","16178","16737","17088","16968","17104","17244","17231","17395","17388","17367","17544","17675","17830","18026","18152","18195","18334","18459","18480","18648","18673"],[" 4459"," 4462"," 4459"," 4473"," 4396"," 4414"," 4491"," 4460"," 4674"," 4795"," 4931"," 5104"," 5223"," 5306"," 5433"," 5568"," 5555"," 5764"," 5810"," 5969"," 6278"," 6566"," 6778"," 7165"," 7218"," 7495"," 7729"," 7751"," 8004"," 7961"," 7981"," 8302"," 8371"," 8425"," 8492"," 8295"," 8425"," 8449"," 8609"," 8703"," 8590"," 8664"," 8759"," 8920"," 9028"," 9051"," 9064"," 9122"," 9527"," 9834"," 9994","10172","10650","11182","12233","13347","14355","15262","16374","17222","17746","18113","17282","17788","17105","17113","17889","17190","16829","16423","16130","15615","15653","15625","15475","15674","15833","15745","15215","14730","14684","14662","15271","15558","15528","15904","15746","15926","16249","16238","16186","16007","15971","16200","16575","17096","17506","17756","17926","18028","18400","18382","18567","18631","18577","18740","18627","18788","18700","18610","18733","18842","18955","19073","19207","19238","19334","19429","19508","19723","19827"],[" 4444"," 4438"," 4476"," 4475"," 4463"," 4443"," 4530"," 4569"," 4780"," 4987"," 4989"," 5105"," 5133"," 5136"," 5350"," 5425"," 5544"," 5746"," 5865"," 6055"," 6265"," 6444"," 6427"," 6564"," 6683"," 6770"," 7020"," 7243"," 7235"," 7309"," 7345"," 7295"," 7286"," 7252"," 7383"," 7400"," 7458"," 7520"," 7449"," 7336"," 7467"," 7554"," 7604"," 7762"," 7801"," 7696"," 7624"," 7584"," 7549"," 7824"," 7961"," 8120"," 8367"," 8596"," 9135"," 9762","10362","10929","11413","12024","12568","13056","13356","13182","13293","13490","13384","13535","13405","12886","12602","12467","12202","12206","12040","11883","11753","11658","11821","11415","11161","10932","10994","11132","11194","11160","10891","11014","11044","11049","11369","11509","11688","12059","12073","12301","12439","12484","12469","12098","12234","12190","12265","12524","12464","12529","12535","12541","12553","12558","12562","12654","12681","12728","12754","12723","12717","12703","12742","12772","12816"],[" 4376"," 4453"," 4611"," 4576"," 4587"," 4624"," 4605"," 4602"," 4652"," 4684"," 4724"," 4871"," 5050"," 5225"," 5301"," 5384"," 5425"," 5474"," 5654"," 5854"," 6092"," 6325"," 6549"," 6613"," 6722"," 6854"," 7033"," 7336"," 7534"," 7562"," 7538"," 7566"," 7428"," 7492"," 7509"," 7475"," 7818"," 7945"," 7964"," 7944"," 7793"," 7721"," 7628"," 7616"," 7512"," 7585"," 7689"," 7689"," 7866"," 7938"," 8135"," 8338"," 8618"," 9024"," 9536","10316","10978","11702","12210","12612","13053","13440","13771","13853","13826","13721","13826","13858","13320","12824","12389","12113","12505","12583","12602","12736","12682","12548","12207","11693","11301","11275","11269","11475","11341","11229","11296","11193","11206","11325","11364","11396","11752","11945","12136","12304","12425","12498","12769","13077","12693","12705","12642","12425","12949","13095","12947","12981","12864","12735","12768","12813","12810","12843","12936","12998","13063","13116","13133","13167","13215"],[" 4417"," 4422"," 4451"," 4268"," 4207"," 4282"," 4255"," 4458"," 4764"," 4785"," 4891"," 4957"," 4852"," 4855"," 5073"," 5231"," 5403"," 5560"," 5482"," 5710"," 5835"," 6034"," 6277"," 6369"," 6624"," 6705"," 7112"," 7341"," 7445"," 7679"," 7414"," 7187"," 6926"," 6924"," 6784"," 7027"," 7349"," 7352"," 7598"," 7673"," 7517"," 7416"," 7511"," 7559"," 7391"," 7496"," 7487"," 7221"," 7435"," 7431"," 7590"," 7878"," 7957"," 8323"," 8562"," 8810"," 9763","10413","10981","11538","11900","12077","12211","12821","12955","12978","12790","12210","11648","11160","11252","11296","11209","11521","11251","11385","11835","11737","11701","11280","10589","10290"," 9992"," 9615"," 9681","10064","10457","10766","10710","10357","10332","10508","10039","10467","10486","10449","11025","10741","11106","11343","11860","12054","11855","11707","11483","11519","11460","11530","11467","11414","11479","11481","11485","11462","11459","11438","11502","11575","11569","11675","11666"],[" 4306"," 4641"," 4648"," 4640"," 4713"," 4567"," 4555"," 4661"," 4845"," 4956"," 5111"," 5211"," 5183"," 5326"," 5386"," 5365"," 5609"," 5768"," 6030"," 6262"," 6301"," 6283"," 6393"," 6657"," 6861"," 7238"," 7442"," 7461"," 7470"," 7555"," 7551"," 7635"," 7677"," 7697"," 7776"," 7793"," 8063"," 8042"," 7991"," 7917"," 7792"," 7867"," 7892"," 7946"," 8015"," 7892"," 7935"," 7933"," 8054"," 8285"," 8722"," 9138"," 9293"," 9475"," 9493"," 9804","10480","11406","12023","12727","13138","13478","13742","13569","13736","13554","13622","13489","13074","12767","12377","12350","11937","12033","12089","12095","12541","12417","12069","11713","10905","10732","10782","10894","11456","11386","11686","11717","11350","11498","11196","11180","11700","11816","12149","12670","12763","12765","13166","13101","13358","13550","13323","13245","13088","13137","13095","13099","13076","13062","13050","13139","13174","13184","13260","13293","13283","13282","13360","13442","13539"],[" 4293"," 4412"," 4449"," 4459"," 4477"," 4430"," 4453"," 4494"," 4604"," 4702"," 4724"," 4688"," 4717"," 4811"," 4969"," 5137"," 5323"," 5448"," 5548"," 5672"," 5808"," 5925"," 6132"," 6463"," 6656"," 6938"," 7210"," 7454"," 7395"," 7387"," 7355"," 7303"," 7469"," 7509"," 7455"," 7349"," 7420"," 7560"," 7573"," 7609"," 7594"," 7537"," 7653"," 7695"," 7715"," 7711"," 7712"," 7721"," 7892"," 8180"," 8454"," 8931"," 9459"," 9875","10605","11137","11797","12486","12730","13335","13734","14224","14686","14916","14759","14755","14712","14512","14071","13683","13333","13027","13046","12964","12953","13002","13167","12931","12785","12698","12569","12750","12661","12376","12409","12377","12454","12710","12867","12850","13023","13156","13339","13524","13721","13932","14037","14305","14544","14687","14733","14783","14812","14734","14859","14955","14865","14936","14854","14756","14818","14943","15035","15172","15263","15316","15365","15398","15503","15619","15731"],[" 4776"," 4658"," 4438"," 4525"," 4330"," 4241"," 4366"," 4468"," 4695"," 4896"," 5093"," 5188"," 5258"," 5303"," 5426"," 5366"," 5580"," 5862"," 5976"," 6377"," 6436"," 6459"," 6685"," 6757"," 7110"," 7424"," 7581"," 7655"," 7727"," 7756"," 7848"," 7905"," 7824"," 7801"," 7642"," 7744"," 7618"," 7747"," 7865"," 7744"," 8083"," 8019"," 7748"," 8005"," 7577"," 7546"," 7806"," 7752"," 8188"," 8452"," 8771"," 8949"," 9238"," 9526"," 9977","10533","11507","12268","12898","13699","13751","14147","14509","14619","15104","15353","15352","15114","14523","14176","13590","13165","13271","12963","13244","13404","12883","12931","12811","13149","13314","12883","12919","11858","11636","11922","11572","12231","12428","12637","12931","13377","13828","13909","13916","13741","13738","13812","14470","14506","14376","14514","14243","14375","14666","14743","14735","14725","14718","14730","14679","14952","15111","15216","15379","15207","15157","15126","15143","15326","15344"],[" 4638"," 4656"," 4406"," 4252"," 4109"," 4024"," 4178"," 4318"," 4481"," 4622"," 4678"," 4752"," 4682"," 4558"," 4784"," 4893"," 5234"," 5448"," 5358"," 5406"," 5503"," 5641"," 5758"," 5855"," 5753"," 5968"," 6183"," 6415"," 6766"," 6754"," 6819"," 6840"," 6443"," 6583"," 6783"," 7022"," 7329"," 7368"," 7326"," 7333"," 7308"," 7418"," 7330"," 7368"," 7377"," 7245"," 7428"," 7610"," 7728"," 8188"," 8158"," 8101"," 8389"," 8696"," 9295","10004","10705","10794","11306","11694","12478","13062","13026","13018","12613","12600","12723","12603","12379","12017","11841","11577","11184","11057","10923","11156","11600","11706","11405","11200","10855","11059","10907","10907","10851","10195","10618","10556","10306","10825","10760","10913","11331","10873","10599","10901","10927","11467","12043","12024","12295","12232","12300","12020","12069","12270","12030","12113","11900","11633","11693","11748","11766","11947","11963","11956","11960","11910","11988","11986","12091"]],"fixedtz":false,"tzone":"UTC"},"evals":[],"jsHooks":[]}</script>
<p>This smoothed graph is much nicer and is easier to interpret.</p>
</div>
